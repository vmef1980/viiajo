<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="theme-color" content="#F47C20" />
  <title>Carrito - GuateCocina</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" />
  <style>
    :root{--p:#F47C20;--pd:#00A86F;--a:#0074B7;--t:#1C3F60;--b:rgba(0,0,0,0.08);--s:0 8px 32px rgba(0,0,0,0.08)}
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Inter',sans-serif;background:linear-gradient(135deg,#fff8f0,#e6f7ff);color:var(--t);padding:2rem 1rem 7rem 1rem;min-height:100vh;position:relative}
    .c{max-width:900px;margin:0 auto;background:white;border-radius:20px;overflow:hidden;box-shadow:var(--s)}
    header{background:var(--p);color:white;padding:1.5rem;text-align:center}
    header h1{margin:0;font-size:1.9rem}
    .i{display:flex;align-items:center;gap:1rem;padding:1rem;border-bottom:1px solid var(--b);position:relative}
    .i img{width:80px;height:80px;object-fit:contain;border-radius:12px}
    .q{background:var(--p);color:white;width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.9rem;position:absolute;top:8px;left:8px}
    .info h3{margin:0 0 .4rem;font-size:1.1rem}
    .pr{color:var(--p);font-weight:700}
    .x{background:#e74c3c;color:white;border:none;width:40px;height:40px;border-radius:50%;cursor:pointer;font-size:1.5rem;font-weight:bold;line-height:38px;text-align:center;flex-shrink:0}
    .se{background:#f8f9fb;padding:1.5rem;border-radius:16px;margin:1.5rem 0}
    .se h3{margin:0 0 1rem;color:var(--a);font-size:1.2rem}
    select{width:100%;padding:.9rem;border-radius:12px;border:1.5px solid var(--b);font-size:1rem;margin:.5rem 0}
    .op label{display:flex;align-items:center;gap:12px;cursor:pointer;font-size:1rem;padding:8px 0}
    .op input[type=radio]{width:auto;margin:0}
    .n{margin-top:.8rem;padding:.9rem;background:#e3f2fd;border-radius:12px;font-size:.92rem;color:#1565c0;border-left:4px solid #42a5f5;line-height:1.5}
    .r{background:#f0f8ff;padding:1.5rem;border-radius:16px;font-size:1.1rem}
    .l{display:flex;justify-content:space-between;margin:.8rem 0}
    .tot{font-size:1.45rem;font-weight:700;color:var(--p);border-top:2px solid var(--p);padding-top:1rem;margin-top:1rem}
    .btn{width:100%;padding:1.1rem;background:var(--p);color:white;border:none;border-radius:16px;font-size:1.25rem;font-weight:700;cursor:pointer;margin-top:1.5rem}
    .btn:hover{background:var(--pd);transform:translateY(-3px);box-shadow:0 10px 30px rgba(0,168,111,.4)}

    /* BOTÓN FLOTANTE "SEGUIR COMPRANDO" */
    .btn-flotante{
      position:fixed;
      bottom:20px;
      right:20px;
      background:var(--pd);
      color:white;
      width:58px;
      height:58px;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:1.8rem;
      box-shadow:0 6px 20px rgba(0,168,111,0.4);
      z-index:1000;
      transition:all .3s ease;
    }
    .btn-flotante:hover{
      background:#008c5a;
      transform:scale(1.1);
    }
    @media (min-width:768px){
      .btn-flotante{ width:62px; height:62px; bottom:30px; right:30px; }
    }
  </style>
</head>
<body>

<div class="c">
  <header><h1>Tu Carrito</h1></header>
  <div id="lista"></div>

  <div id="lleno" style="display:none">
    <div class="se">
      <h3>Zona de Entrega</h3>
      <select id="zona">
        <option value="25">Ciudad de Guatemala - Q25</option>
        <option value="35">Mixco, Fraijanes, Villa Nueva, etc. - Q35</option>
        <option value="40" selected>Departamentos (todo el país) - Q40</option>
      </select>
      <div class="n"><strong>Nota:</strong> El costo de envío es base. Puede variar ±Q5-Q15. ¡Te lo confirmamos por WhatsApp!</div>

      <h3 style="margin-top:1.5rem">Método de Pago</h3>
      <div class="op"><label><input type="radio" name="pago" value="t" checked><span>Transferencia / Depósito Bancario</span></label></div>
      <div class="op"><label><input type="radio" name="pago" value="c"><span>Contraentrega <span style="color:#e74c3c;font-weight:bold">(+5% solo en departamentos)</span></span></label></div>
    </div>

    <div class="r">
      <div class="l"><span>Subtotal:</span> <strong id="sub">Q0.00</strong></div>
      <div class="l"><span>Envío:</span> <strong id="env">Q40.00</strong></div>
      <div class="l" id="rec" style="display:none;color:#e74c3c"><span>Recargo contraentrega (5%):</span> <strong id="re">Q0.00</strong></div>
      <div class="l tot"><span>Total a pagar:</span> <strong id="tot">Q40.00</strong></div>
    </div>

    <button class="btn" onclick="fin()">Enviar pedido por WhatsApp</button>
  </div>

  <div id="vacio" style="text-align:center;padding:5rem 2rem">
    <h2>Tu carrito está vacío</h2>
    <p><a href="index.html" style="color:var(--a);font-weight:600">Volver a la tienda</a></p>
  </div>
</div>

<!-- BOTÓN FLOTANTE "SEGUIR COMPRANDO" -->
<a href="index.html" class="btn-flotante" title="Seguir comprando">
  <i class="bi bi-cart-plus"></i>
</a>

<script>
  const $ = s => document.getElementById(s);
  const zona = $('zona');

  const agrupar = () => {
    const map = {};
    JSON.parse(localStorage.getItem("carrito")||"[]").forEach(p => {
      map[p.id] ? (map[p.id].c += 1, map[p.id].t += p.precio) : (map[p.id] = {...p, c:1, t:p.precio});
    });
    return Object.values(map);
  };

  const act = () => {
    const items = agrupar();
    $('lista').innerHTML = "";
    if (!items.length) { $('vacio').style.display="block"; return; }
    $('vacio').style.display="none"; $('lleno').style.display="block";

    items.forEach(i => {
      $('lista').innerHTML += `
        <div class="i">
          ${i.c>1 ? `<div class="q">${i.c}</div>` : ''}
          <img src="${i.imagen||'img/placeholder.png'}" alt="${i.titulo}">
          <div class="info flex-grow">
            <h3>${i.titulo}</h3>
            <p class="pr">Q${i.t.toFixed(2)} ${i.c>1?`(Q${i.precio} c/u)`:""}</p>
          </div>
          <button class="x" onclick="elim('${i.id}')">×</button>
        </div>`;
    });
    $('sub').textContent = `Q${items.reduce((a,b)=>a+b.t,0).toFixed(2)}`;
    calc();
  };

  const calc = () => {
    const items = agrupar();
    const sub = items.reduce((a,b)=>a+b.t,0);
    const env = +zona.value;
    const contra = document.querySelector('input[value="c"]').checked;
    const rec = contra && env===40 ? sub*0.05 : 0;

    $('env').textContent = `Q${env.toFixed(2)}`;
    $('rec').style.display = rec?"flex":"none";
    $('re').textContent = `Q${rec.toFixed(2)}`;
    $('tot').textContent = `Q${(sub+env+rec).toFixed(2)}`;
  };

  window.elim = id => {
    let c = JSON.parse(localStorage.getItem("carrito")||"[]");
    c = c.filter(p => p.id !== id);
    localStorage.setItem("carrito", JSON.stringify(c));
    act();
  };

  window.fin = () => {
    const items = agrupar();
    const sub = items.reduce((a,b)=>a+b.t,0);
    const env = +zona.value;
    const ztxt = zona.selectedOptions[0].text.split(" - ")[0];
    const contra = document.querySelector('input[value="c"]').checked;
    const rec = contra && env===40 ? sub*0.05 : 0;

    let m = "*¡Hola GuateCocina!*%0AMi pedido:%0A%0A";
    items.forEach(i=>m+=`• ${i.titulo} ×${i.c} - Q${i.t.toFixed(2)}%0A`);
    m += `%0A*Subtotal:* Q${sub.toFixed(2)}`;
    m += `%0A*Envío (${ztxt}):* Q${env.toFixed(2)}`;
    if(rec) m += `%0A*Recargo contraentrega (5%):* Q${rec.toFixed(2)}`;
    m += `%0A%0A*TOTAL: Q${(sub+env+rec).toFixed(2)}*%0A%0A`;
    m += `*Pago:* ${contra?"Contraentrega":"Transferencia"}%0A¡Gracias!`;

    open("https://wa.me/50241084481?text="+m,"_blank");
  };

  zona.onchange = calc;
  document.querySelectorAll('input[name="pago"]').forEach(r=>r.onclick=calc);
  act();
</script>
</body>
</html>